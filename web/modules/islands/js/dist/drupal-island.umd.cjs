(function(n){typeof define=="function"&&define.amd?define(n):n()})(function(){"use strict";var f=Object.defineProperty;var m=(n,o,i)=>o in n?f(n,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[o]=i;var d=(n,o,i)=>m(n,typeof o!="symbol"?o+"":o,i);const i=class i extends HTMLElement{constructor(){super(),this.ready=new Promise(t=>{this.readyResolve=t})}static getParents(t,e=!1){let a=[];for(;t;){if(t.matches&&t.matches(i.tagName)){if(e&&t===e)break;o.hasConditions(t)&&a.push(t)}t=t.parentNode}return a}static async ready(t,e){if(e||(e=i.getParents(t)),e.length===0)return;let a=await Promise.all(e.map(r=>r.wait()));if(a.length)return a[0]}forceFallback(){window.Island&&Object.assign(i.fallback,window.Island.fallback);for(let t in i.fallback){let e=Array.from(this.querySelectorAll(t)).reverse();for(let a of e){if(!a.isConnected)continue;let r=i.getParents(a);if(r.length===1){let s=i.ready(a,r);i.fallback[t](s,a,i.prefix)}}}}wait(){return this.ready}async connectedCallback(){o.hasConditions(this)&&this.forceFallback(),await this.hydrate()}getTemplates(){return this.querySelectorAll(`template[${i.attr.template}]`)}replaceTemplates(t){for(let e of t){if(i.getParents(e,this).length>0)continue;let a=e.getAttribute(i.attr.template);if(a==="replace"){let r=Array.from(this.childNodes);for(let s of r)this.removeChild(s);this.appendChild(e.content);break}else{let r=e.innerHTML;if(a==="once"&&r){if(i.onceCache.has(r)){e.remove();return}i.onceCache.set(r,!0)}e.replaceWith(e.content)}}}async hydrate(){let t=[];this.parentNode&&t.push(i.ready(this.parentNode));let e=o.getConditions(this);for(let a in e)o.map[a]&&t.push(o.map[a](e[a],this));await Promise.all(t),this.replaceTemplates(this.getTemplates());for(let a of i.onReady.values())await a.call(this,i);this.readyResolve(),this.setAttribute(i.attr.ready,""),this.querySelectorAll(`[${i.attr.defer}]`).forEach(a=>a.removeAttribute(i.attr.defer))}};d(i,"tagName","is-land"),d(i,"prefix","is-land--"),d(i,"attr",{template:"data-island",ready:"ready",defer:"defer-hydration"}),d(i,"onceCache",new Map),d(i,"onReady",new Map),d(i,"fallback",{":not(is-land,:defined,[defer-hydration])":(t,e,a)=>{let r=document.createElement(a+e.localName);for(let l of e.getAttributeNames())r.setAttribute(l,e.getAttribute(l));let s=e.shadowRoot;if(!s){let l=e.querySelector(":scope > template:is([shadowrootmode], [shadowroot])");if(l){let h=l.getAttribute("shadowrootmode")||l.getAttribute("shadowroot")||"closed";s=e.attachShadow({mode:h}),s.appendChild(l.content.cloneNode(!0))}}return s&&r.attachShadow({mode:s.mode}).append(...s.childNodes),r.append(...e.childNodes),e.replaceWith(r),t.then(()=>{r.shadowRoot&&e.shadowRoot.append(...r.shadowRoot.childNodes),e.append(...r.childNodes),r.replaceWith(e)})}});let n=i;const c=class c{static hasConditions(t){return Object.keys(c.getConditions(t)).length>0}static getConditions(t){let e={};for(let a of Object.keys(c.map))t.hasAttribute(`on:${a}`)&&(e[a]=t.getAttribute(`on:${a}`));return e}static visible(t,e){if("IntersectionObserver"in window)return new Promise(a=>{let r=new IntersectionObserver(s=>{let[l]=s;l.isIntersecting&&(r.unobserve(l.target),a())});r.observe(e)})}static idle(){let t=new Promise(e=>{document.readyState!=="complete"?window.addEventListener("load",()=>e(),{once:!0}):e()});return"requestIdleCallback"in window?Promise.all([new Promise(e=>{requestIdleCallback(()=>{e()})}),t]):t}static interaction(t,e){let a=["click","touchstart"];return t&&(a=(t||"").split(",").map(r=>r.trim())),new Promise(r=>{function s(l){r();for(let h of a)e.removeEventListener(h,s)}for(let l of a)e.addEventListener(l,s,{once:!0})})}static media(t){let e={matches:!0};if(t&&"matchMedia"in window&&(e=window.matchMedia(t)),!e.matches)return new Promise(a=>{e.addListener(r=>{r.matches&&a()})})}static saveData(t){if(!(!("connection"in navigator)||navigator.connection.saveData===(t!=="false")))return new Promise(()=>{})}};d(c,"map",{visible:c.visible,idle:c.idle,interaction:c.interaction,media:c.media,"save-data":c.saveData});let o=c;"customElements"in window&&(window.customElements.define(n.tagName,n),window.Island=n),n.ready});
